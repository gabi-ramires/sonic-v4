<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#000000" />
    <title>Sonic V4 - Teste</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #000;
        overflow: hidden;
        position: fixed;
        width: 100%;
        height: 100%;
        touch-action: none;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      
      canvas {
        display: block;
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }
      
      /* Prevenir zoom em dispositivos mÃ³veis */
      @media screen and (max-width: 768px) {
        body {
          font-size: 16px;
        }
        
        canvas {
          width: 100vw;
          height: 100vh;
        }
      }
      
      /* Esconder scrollbars */
      ::-webkit-scrollbar {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="game-container">
      <h1 style="color: white; text-align: center; padding: 20px;">Sonic V4 - Teste Responsivo</h1>
      <p style="color: white; text-align: center; padding: 10px;">Carregando...</p>
    </div>
    
    <script type="module">
      // Importar o Kaplay diretamente
      import kaplay from 'https://unpkg.com/kaplay@3001.0.0-alpha.21/dist/kaplay.js';
      
      // Detectar se Ã© dispositivo mÃ³vel
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;
      
      // ConfiguraÃ§Ãµes responsivas
      const getResponsiveConfig = () => {
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        
        if (isMobile) {
          const aspectRatio = 16 / 9;
          let targetWidth, targetHeight;
          
          if (screenWidth / screenHeight > aspectRatio) {
            targetHeight = screenHeight;
            targetWidth = targetHeight * aspectRatio;
          } else {
            targetWidth = screenWidth;
            targetHeight = targetWidth / aspectRatio;
          }
          
          return {
            width: Math.floor(targetWidth),
            height: Math.floor(targetHeight),
            fontSize: Math.max(16, Math.min(screenWidth / 30, 48))
          };
        } else {
          return {
            width: 1920,
            height: 1080,
            fontSize: 32
          };
        }
      };
      
      const config = getResponsiveConfig();
      
      const k = kaplay({
        width: config.width,
        height: config.height,
        letterbox: true,
        background: [0, 0, 0],
        global: false,
        buttons: {
          jump: {
            keyboard: ["space"],
            mouse: "left",
          },
        },
        touchToMouse: true,
        debug: false,
      });
      
      // FunÃ§Ãµes responsivas
      k.getResponsiveFontSize = (baseSize) => {
        const responsiveSize = Math.max(baseSize * 0.5, Math.min(baseSize, config.fontSize));
        return Math.floor(responsiveSize);
      };
      
      k.getResponsivePos = (x, y) => {
        if (isMobile) {
          return k.vec2(
            (x / 1920) * config.width,
            (y / 1080) * config.height
          );
        }
        return k.vec2(x, y);
      };
      
      // Carregar recursos
      k.loadSprite("chemical-bg", "public/graphics/chemical-bg.png");
      k.loadSprite("platforms", "public/graphics/platforms.png");
      k.loadSprite("sonic", "public/graphics/sonic.png", {
        sliceX: 8,
        sliceY: 2,
        anims: {
          run: { from: 0, to: 7, loop: true, speed: 30 },
          jump: { from: 8, to: 15, loop: true, speed: 100 },
        },
      });
      k.loadSprite("ring", "public/graphics/ring.png", {
        sliceX: 16,
        sliceY: 1,
        anims: {
          spin: { from: 0, to: 15, loop: true, speed: 30 },
        },
      });
      k.loadSprite("motobug", "public/graphics/motobug.png", {
        sliceX: 5,
        sliceY: 1,
        anims: {
          run: { from: 0, to: 4, loop: true, speed: 8 },
        },
      });
      k.loadFont("mania", "public/fonts/mania.ttf");
      
      // Cena de teste simples
      k.scene("test", () => {
        k.add([
          k.text("SONIC V4 - TESTE RESPONSIVO", { 
            font: "mania", 
            size: k.getResponsiveFontSize(48) 
          }),
          k.anchor("center"),
          k.pos(k.center()),
        ]);
        
        k.add([
          k.text("Pressione EspaÃ§o/Clique/Toque para Testar", { 
            font: "mania", 
            size: k.getResponsiveFontSize(24) 
          }),
          k.anchor("center"),
          k.pos(k.center().x, k.center().y + 100),
        ]);
        
        k.onButtonPress("jump", () => {
          k.add([
            k.text("FUNCIONOU! ðŸŽ‰", { 
              font: "mania", 
              size: k.getResponsiveFontSize(36),
              color: k.Color.YELLOW
            }),
            k.anchor("center"),
            k.pos(k.center().x, k.center().y + 200),
          ]);
        });
      });
      
      k.go("test");
    </script>
  </body>
</html> 